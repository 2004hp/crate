<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Aggregation &mdash; CrateDB  documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/normalize.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/bootstrap.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/mmenu.all.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/components.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/crateio.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/crateio-rtd.css?ver=1.1" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/custom.css?ver=1.1" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!--[if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
    <script type="text/javascript" src="https://cdn.crate.io/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="../../_static/js/modernizr.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/underscore.min.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/doctools.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/searchtools.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/webflow.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/mmenu.all.min.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/fontawesome.js?ver=1.1"></script>
    <script type="text/javascript" src="../../_static/js/custom.js?ver=1.1"></script>
    <link rel="top" title="CrateDB  documentation" href="../../index.html" />
    <link rel="up" title="Built-in Functions and Operators" href="index.html" />
    <link rel="next" title="Arithmetic Operators" href="arithmetic.html" />
    <link rel="prev" title="Scalar Functions" href="scalar.html" />
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  </head>
  <body>
  <header class="header-nav">
  <div class="container">
    <div class="navbar w-nav" data-animation="default" data-collapse="small" data-contain="1" data-duration="400">
      <a class="brand w-nav-brand" href="https://crate.io">
        <img src="../../_static/images/logo-crate.png" width="217">
      </a>
      <nav class="w-nav-menu main-nav" role="navigation">
        <div class="dropdownBackground">
          <span class="arrow"></span>
        </div>
        <ul id="menu-top-navigation" class="menu">
          <li class="navlink w-nav-link menu-item"><a href="https://crate.io/overview/">CrateDB</a></li>
          <li class="navlink w-nav-link menu-item menu-item-has-children"><a href="https://crate.io/cratedb-solutions/">Use Cases</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://crate.io/customers/">Customers</a></li>
              <li class="menu-item"><a href="https://crate.io/iot-sensor-solutions/">IoT &amp; Sensor Data</a></li>
              <li class="menu-item"><a href="https://crate.io/geospatial-analytics/">Geospatial Analytics</a></li>
              <li class="menu-item"><a href="https://crate.io/cyber-security/">Cyber Security</a></li>
              <li class="menu-item"><a href="https://crate.io/time-series/">Time Series</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item"><a href="https://crate.io/pricing/">Pricing</a></li>
          <li class="navlink w-nav-link menu-item menu-item-has-children"><a>Resources</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://crate.io/docs/">Documentation</a></li>
              <li class="menu-item"><a href="https://crate.io/resources/">Resource Library</a></li>
              <li class="menu-item"><a href="https://crate.io/blog/">Blog</a></li>
              <li class="menu-item"><a href="https://crate.io/community/">Community</a></li>
            </ul>
          </li>
          <li class="btn-link w-nav-link menu-item"><a href="https://crate.io/download/">Download</a></li>
        </ul>
      </nav>

      <div id="mobile-nav" class="mm-menu">
        <ul class="offcanvas-menu">
          <li class="navlink w-nav-link menu-item"><a href="https://crate.io/overview/">CrateDB</a></li>
          <li class="navlink w-nav-link menu-item menu-item-has-children"><a href="https://crate.io/cratedb-solutions/">Use Cases</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://crate.io/customers/">Customers</a></li>
              <li class="menu-item"><a href="https://crate.io/iot-sensor-solutions/">IoT &amp; Sensor Data</a></li>
              <li class="menu-item"><a href="https://crate.io/geospatial-analytics/">Geospatial Analytics</a></li>
              <li class="menu-item"><a href="https://crate.io/cyber-security/">Cyber Security</a></li>
              <li class="menu-item"><a href="https://crate.io/time-series/">Time Series</a></li>
            </ul>
          </li>
          <li class="navlink w-nav-link menu-item"><a href="https://crate.io/pricing/">Pricing</a></li>
          <li class="navlink w-nav-link menu-item menu-item-has-children"><a>Resources</a>
            <ul class="sub-menu">
              <li class="menu-item"><a href="https://crate.io/docs/">Documentation</a></li>
              <li class="menu-item"><a href="https://crate.io/resources/">Resource Library</a></li>
              <li class="menu-item"><a href="https://crate.io/blog/">Blog</a></li>
              <li class="menu-item"><a href="https://crate.io/community/">Community</a></li>
            </ul>
          </li>
          <li class="btn-link w-nav-link menu-item"><a href="https://crate.io/download/">Download</a></li>
        </ul>
      </div>

      <a href="#mobile-nav" class="fa fa-bars mobile-nav-button"></a>
    </div>
  </div>
</header>

  <div class="w-section section border-top">
    <div class="w-container w-hidden-main margin-bottom-32">
      <div class="section" style="margin: 0px">
        <a href="#" id="mobile-menu-toggler" class="w-button">Toggle Doc Menu</a>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-md-4 col-lg-3">
          <aside class="wrapper-navleft"><div role="complementary" class="bs-docs-sidebar hidden-print" id="nav-affix">
  <div class="search-link">
    <a href="../../search.html" class="btn btn-primary">Search Documentation</a>
  </div>
  <ul class="bs-docs-sidenav bs-sidenav nav" role="complementary">

    

    
      <ul class="toctree nav nav-list">
  <li class="navleft-item">CrateDB</li>
  <ul>
    
    <li class="navleft-item"><a href="/docs/crate/getting-started/">Getting Started</a></li>
    
    
    <li class="current">
      <a class="current-active" href="../../index.html" title="CrateDB">Reference</a>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../run.html">Running CrateDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../run.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../run.html#command-line-options">Command Line Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../run.html#signal-handling">Signal Handling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../config/index.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../config/node.html">Node Specific Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#basics">Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#node-types">Node Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#read-only-node">Read-only node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#hosts">Hosts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#ports">Ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#paths">Paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#plugins">Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#memory">Memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#garbage-collection">Garbage Collection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#elasticsearch-http-rest-api">Elasticsearch HTTP REST API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#cross-origin-resource-sharing-cors">Cross-Origin Resource Sharing (CORS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#blobs">Blobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#repositories">Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#queries">Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/node.html#custom-attributes">Custom Attributes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config/cluster.html">Cluster Wide Settings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#non-runtime-cluster-wide-settings">Non-Runtime Cluster Wide Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#collecting-stats">Collecting Stats</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#usage-data-collector">Usage Data Collector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#graceful-stop">Graceful Stop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#bulk-operations">Bulk Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#discovery">Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#routing-allocation">Routing Allocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#recovery">Recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#store-level-throttling">Store Level Throttling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#query-circuit-breaker">Query Circuit Breaker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#field-data-circuit-breaker">Field Data Circuit Breaker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#request-circuit-breaker">Request Circuit Breaker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#thread-pools">Thread Pools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/cluster.html#metadata">Metadata</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config/session.html">Session Setting Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config/logging.html">Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../config/logging.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/logging.html#settings">Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config/environment.html">Environment Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../config/environment.html#crate-home"><code class="docutils literal"><span class="pre">CRATE_HOME</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/environment.html#crate-java-opts"><code class="docutils literal"><span class="pre">CRATE_JAVA_OPTS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/environment.html#crate-heap-size"><code class="docutils literal"><span class="pre">CRATE_HEAP_SIZE</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config/system.html">Operating System Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../config/system.html#virtual-memory">Virtual Memory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config/enterprise.html">Enterprise Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../config/enterprise.html#enterprise-license">Enterprise License</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/enterprise.html#javascript-language">Javascript Language</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/enterprise.html#authentication">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../config/enterprise.html#secured-communications-ssl-tls">Secured Communications (SSL/TLS)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">General Use</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ddl/index.html">Data Definition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ddl/create-table.html">Creating Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/data-types.html">Data Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/system-columns.html">System Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/generated-columns.html">Generated Columns</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/constraints.html">Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/storage.html">Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/partitioned-tables.html">Partitioned Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/sharding.html">Sharding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/replication.html">Replication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/column-policy.html">Column Policy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/fulltext-indices.html">Fulltext Indices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/analyzers.html">Fulltext Analyzers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/show-create-table.html">Show Create Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ddl/alter-table.html">Altering Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dml.html">Data Manipulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dml.html#inserting-data">Inserting Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dml.html#updating-data">Updating Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dml.html#deleting-data">Deleting Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dml.html#import-and-export">Import and Export</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dql/index.html">Querying Crate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dql/selects.html">Selecting Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dql/joins.html">Joins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dql/union.html">Union All</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dql/refresh.html">Refresh</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dql/fulltext.html">Fulltext Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dql/geo.html">Geo Search</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Built-in Functions and Operators</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="scalar.html">Scalar Functions</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Aggregation</a></li>
<li class="toctree-l3"><a class="reference internal" href="arithmetic.html">Arithmetic Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="table-functions.html">Table Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="operators.html">Comparison Operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="array-comparisons.html">Array Comparisons</a></li>
<li class="toctree-l3"><a class="reference internal" href="subquery-expressions.html">Subquery Expressions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user-defined-functions.html">User-Defined Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user-defined-functions.html#create-or-replace"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">OR</span> <span class="pre">REPLACE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../user-defined-functions.html#supported-types">Supported Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user-defined-functions.html#overloading">Overloading</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user-defined-functions.html#determinism">Determinism</a></li>
<li class="toctree-l3"><a class="reference internal" href="../user-defined-functions.html#drop-function"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">FUNCTION</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../user-defined-functions.html#supported-languages">Supported Languages</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../blobs.html">Blobs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../blobs.html#creating-a-table-for-blobs">Creating a Table for Blobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blobs.html#custom-location-for-storing-blob-data">Custom Location for Storing Blob Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blobs.html#list">List</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blobs.html#altering-a-blob-table">Altering a Blob Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blobs.html#deleting-a-blob-table">Deleting a Blob Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../blobs.html#using-blob-tables">Using Blob Tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../occ.html">Optimistic Concurrency Control</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../occ.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../occ.html#optimistic-update">Optimistic Update</a></li>
<li class="toctree-l3"><a class="reference internal" href="../occ.html#optimistic-delete">Optimistic Delete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../occ.html#known-limitations">Known Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../information-schema.html">Information Schema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../information-schema.html#access">Access</a></li>
<li class="toctree-l3"><a class="reference internal" href="../information-schema.html#virtual-tables">Virtual Tables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/index.html">Administration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../admin/system-information.html">System Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#cluster">Cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#nodes">Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#node-checks">Node Checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#shards">Shards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#jobs-operations-and-logs">Jobs, Operations, and Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#cluster-checks">Cluster Checks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#repositories">Repositories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#snapshots">Snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#summits">Summits</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#users">Users</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#allocations">Allocations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/system-information.html#shard-table-permissions">Shard Table Permissions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/runtime-config.html">Runtime Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/user-management.html">User Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/user-management.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/user-management.html#create-user"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/user-management.html#alter-user"><code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/user-management.html#drop-user"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/user-management.html#list-users">List Users</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/privileges.html">Privileges</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/privileges.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/privileges.html#privilege-types">Privilege Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/privileges.html#hierarchical-inheritance-of-privileges">Hierarchical Inheritance of Privileges</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/privileges.html#behavior-of-grant-deny-and-revoke">Behavior of <code class="docutils literal"><span class="pre">GRANT</span></code>, <code class="docutils literal"><span class="pre">DENY</span></code> and <code class="docutils literal"><span class="pre">REVOKE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/privileges.html#list-privileges">List Privileges</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/auth/index.html">Authentication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/auth/methods.html">Authentication Methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/auth/hba.html">Host Based Authentication (HBA)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/ssl.html">Secured Communications (SSL/TLS)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/ssl.html#ssl-tls-configuration">SSL/TLS Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/ssl.html#setting-up-a-keystore-truststore-with-a-certificate-chain">Setting up a Keystore/Truststore With a Certificate Chain</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/ingestion/index.html">Ingestion Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/ingestion/sources/index.html">Ingestion Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/ingestion/rules.html">Ingestion Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/optimization.html">Optimization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/optimization.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/optimization.html#multiple-table-optimization">Multiple Table Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/optimization.html#partition-optimization">Partition Optimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/optimization.html#segments-upgrade">Segments Upgrade</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/jobs-management.html">Jobs Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/monitoring.html">JMX Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/monitoring.html#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/monitoring.html#using-docker">Using Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/monitoring.html#jmx-beans">JMX Beans</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/snapshots.html">Snapshots</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/snapshots.html#snapshot">Snapshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/snapshots.html#restore">Restore</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/snapshots.html#cleanup">Cleanup</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/snapshots.html#requirements-for-using-hdfs-repositories">Requirements for Using HDFS Repositories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/discovery.html">Cloud Discovery</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/discovery.html#amazon-ec2-discovery">Amazon EC2 Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/discovery.html#microsoft-azure-discovery">Microsoft Azure Discovery</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../admin/udc.html">Usage Data Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../admin/udc.html#technical-information">Technical Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/udc.html#admin-ui-tracking">Admin UI Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/udc.html#configuration">Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../admin/udc.html#how-to-disable-udc">How to Disable UDC</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../sql/index.html">SQL Syntax</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../sql/general/index.html">General SQL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../sql/general/constraints.html">Constraints</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/general/value-expressions.html">Value Expressions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/general/lexical-structure.html">Lexical Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../sql/statements/index.html">SQL Statements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/alter-cluster.html"><code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">CLUSTER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/alter-table.html"><code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/alter-user.html"><code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/copy-from.html"><code class="docutils literal"><span class="pre">COPY</span> <span class="pre">FROM</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/copy-to.html"><code class="docutils literal"><span class="pre">COPY</span> <span class="pre">TO</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-analyzer.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">ANALYZER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-blob-table.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">BLOB</span> <span class="pre">TABLE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-function.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">FUNCTION</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-ingest-rule.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">INGEST</span> <span class="pre">RULE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-repository.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">REPOSITORY</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-snapshot.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">SNAPSHOT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-table.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/create-user.html"><code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/delete.html"><code class="docutils literal"><span class="pre">DELETE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/deny.html"><code class="docutils literal"><span class="pre">DENY</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/drop-function.html"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">FUNCTION</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/drop-ingest-rule.html"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">INGEST</span> <span class="pre">RULE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/drop-repository.html"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">REPOSITORY</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/drop-snapshot.html"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">SNAPSHOT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/drop-table.html"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">TABLE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/drop-user.html"><code class="docutils literal"><span class="pre">DROP</span> <span class="pre">USER</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/explain.html"><code class="docutils literal"><span class="pre">EXPLAIN</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/grant.html"><code class="docutils literal"><span class="pre">GRANT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/insert.html"><code class="docutils literal"><span class="pre">INSERT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/kill.html"><code class="docutils literal"><span class="pre">KILL</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/optimize.html"><code class="docutils literal"><span class="pre">OPTIMIZE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/refresh.html"><code class="docutils literal"><span class="pre">REFRESH</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/restore-snapshot.html"><code class="docutils literal"><span class="pre">RESTORE</span> <span class="pre">SNAPSHOT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/revoke.html"><code class="docutils literal"><span class="pre">REVOKE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/select.html"><code class="docutils literal"><span class="pre">SELECT</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/set.html"><code class="docutils literal"><span class="pre">SET</span></code> and <code class="docutils literal"><span class="pre">RESET</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/set-transaction.html"><code class="docutils literal"><span class="pre">SET</span> <span class="pre">TRANSACTION</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/show-columns.html"><code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">COLUMNS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/show-create-table.html"><code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">CREATE</span> <span class="pre">TABLE</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/show-schemas.html"><code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">SCHEMAS</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/show-tables.html"><code class="docutils literal"><span class="pre">SHOW</span> <span class="pre">TABLES</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../sql/statements/update.html"><code class="docutils literal"><span class="pre">UPDATE</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../interfaces/index.html">Client Interfaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../interfaces/http.html">HTTP Endpoint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/http.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/http.html#parameter-substitution">Parameter Substitution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/http.html#default-schema">Default Schema</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/http.html#column-types">Column Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/http.html#bulk-operations">Bulk Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/http.html#error-handling">Error Handling</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../interfaces/postgres.html">PostgreSQL Wire Protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/postgres.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/postgres.html#server-compatibility-and-implementation-status">Server Compatibility and Implementation Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/postgres.html#client-compatibility">Client Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../interfaces/postgres.html#implementation-differences">Implementation Differences</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../enterprise/index.html">Enterprise Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.html">Appendices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../appendices/release-notes/index.html">Release Notes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/release-notes/index.html#x">2.x</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/release-notes/index.html#id6">1.x</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../appendices/sql-compliance.html">Standard SQL Compliance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#data-types">Data Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#create-table">Create Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#alter-table">Alter Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#insert-update-and-delete">Insert, Update, and Delete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#system-information-tables">System Information Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#blob-support">BLOB Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#transactions-begin-commit-and-rollback">Transactions (<code class="docutils literal"><span class="pre">BEGIN</span></code>, <code class="docutils literal"><span class="pre">COMMIT</span></code>, and <code class="docutils literal"><span class="pre">ROLLBACK</span></code>)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../appendices/sql-compliance.html#unsupported-features-and-functions">Unsupported Features and Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../appendices/supported-features.html">Supported Features</a></li>
</ul>
</li>
</ul>

    </li>
    
    
    <li class="navleft-item"><a href="/docs/crate/guide">Guide</a></li>
    
  </ul>
  <li class="navleft-item">CrateDB Clients</li>
  <ul>
    
    <li class="navleft-item"><a href="/docs/clients/crash">The CrateDB Shell</a></li>
    
    
    <li class="navleft-item"><a href="/docs/clients/python">Python</a></li>
    
    
    <li class="navleft-item"><a href="/docs/clients/jdbc">JDBC</a></li>
    
    
    <li class="navleft-item"><a href="/docs/clients/dbal">PHP DBAL</a></li>
    
    
    <li class="navleft-item"><a href="/docs/clients/pdo">PHP PDO</a></li>
    
  </ul>

  <li class="navleft-item border-top"><a href="https://github.com/crate/crate-sample-apps">Sample Applications</a></li>
  <li class="navleft-item"><a href="/docs/support/">Support</a></li>
</ul>
    

    
      
      
    

    
    

    
      <li></li>
    

  </ul>
</div>
            
          </aside>
        </div>
        <div class="col-md-8 col-lg-9">
          <div class="wrapper-content-right">
            
  <div class="section" id="aggregation">
<span id="id1"></span><h1>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h1>
<p class="rubric">Table of Contents</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id6">Introduction</a></li>
<li><a class="reference internal" href="#count" id="id7"><code class="docutils literal"><span class="pre">count</span></code></a><ul>
<li><a class="reference internal" href="#aggregation-count-star" id="id8"><code class="docutils literal"><span class="pre">count(*)</span></code></a></li>
<li><a class="reference internal" href="#count-columnname" id="id9"><code class="docutils literal"><span class="pre">count(columnName)</span></code></a></li>
<li><a class="reference internal" href="#count-distinct-columnname" id="id10"><code class="docutils literal"><span class="pre">count(distinct</span> <span class="pre">columnName)</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#min" id="id11"><code class="docutils literal"><span class="pre">min</span></code></a></li>
<li><a class="reference internal" href="#max" id="id12"><code class="docutils literal"><span class="pre">max</span></code></a></li>
<li><a class="reference internal" href="#sum" id="id13"><code class="docutils literal"><span class="pre">sum</span></code></a></li>
<li><a class="reference internal" href="#avg-and-mean" id="id14"><code class="docutils literal"><span class="pre">avg</span></code> and <code class="docutils literal"><span class="pre">mean</span></code></a><ul>
<li><a class="reference internal" href="#avg-distinct-columnname" id="id15"><code class="docutils literal"><span class="pre">avg(distinct</span> <span class="pre">columnName)</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#geometric-mean" id="id16"><code class="docutils literal"><span class="pre">geometric_mean</span></code></a></li>
<li><a class="reference internal" href="#variance" id="id17"><code class="docutils literal"><span class="pre">variance</span></code></a></li>
<li><a class="reference internal" href="#stddev" id="id18"><code class="docutils literal"><span class="pre">stddev</span></code></a></li>
<li><a class="reference internal" href="#percentile" id="id19"><code class="docutils literal"><span class="pre">percentile</span></code></a></li>
<li><a class="reference internal" href="#arbitrary" id="id20"><code class="docutils literal"><span class="pre">arbitrary</span></code></a></li>
<li><a class="reference internal" href="#hyperloglog-distinct" id="id21"><code class="docutils literal"><span class="pre">hyperloglog_distinct</span></code></a></li>
<li><a class="reference internal" href="#limitations" id="id22">Limitations</a></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id6">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>An <em>aggregation function</em> operates on multiple values of the specified column
of your <cite>SELECT</cite>. For example, <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">avg(temperature)</span></code> will return the
average value of the <code class="docutils literal"><span class="pre">temperature</span></code> column across all rows being considered.</p>
<p>You can apply aggregation functions to the results of a whole query, or to each
of the rows produced by a <a class="reference internal" href="../dql/selects.html#sql-dql-group-by"><span class="std std-ref">GROUP BY</span></a> query.</p>
<p>So for example, <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span> <span class="pre">type,</span> <span class="pre">location</span></code> will produce one result row for
every distinct combination of type and location. In this instance,
<code class="docutils literal"><span class="pre">avg(temperature)</span></code> would return the average temperature for every grouped
row.</p>
<p>If you&#8217;re not using <cite>GROUP BY</cite>, an aggregation function will collapse your
query result into one row, with one returned aggregation value.</p>
<p>For a tabulated summary of aggregation functions, see
<a class="reference internal" href="../dql/selects.html#sql-dql-aggregation"><span class="std std-ref">Data Aggregation</span></a>.</p>
</div>
<div class="section" id="count">
<h2><a class="toc-backref" href="#id7"><code class="docutils literal"><span class="pre">count</span></code></a><a class="headerlink" href="#count" title="Permalink to this headline">¶</a></h2>
<div class="section" id="aggregation-count-star">
<span id="id2"></span><h3><a class="toc-backref" href="#id8"><code class="docutils literal"><span class="pre">count(*)</span></code></a><a class="headerlink" href="#aggregation-count-star" title="Permalink to this headline">¶</a></h3>
<p>This aggregation function simply returns the number of rows that match the
query.</p>
<p><cite>count(columName)</cite> is also possible, but currently only works on a primary key
column. The semantics are the same.</p>
<p>The return value is always of type <code class="docutils literal"><span class="pre">long</span></code>.</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+----------+</span>
<span class="go">| count(*) |</span>
<span class="go">+----------+</span>
<span class="go">| 13       |</span>
<span class="go">+----------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">count(*)</span></code> can also be used on group by queries:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">asc</span><span class="p">;</span>
<span class="go">+----------+-------------+</span>
<span class="go">| count(*) | kind        |</span>
<span class="go">+----------+-------------+</span>
<span class="go">| 4        | Galaxy      |</span>
<span class="go">| 5        | Planet      |</span>
<span class="go">| 4        | Star System |</span>
<span class="go">+----------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
</div>
<div class="section" id="count-columnname">
<h3><a class="toc-backref" href="#id9"><code class="docutils literal"><span class="pre">count(columnName)</span></code></a><a class="headerlink" href="#count-columnname" title="Permalink to this headline">¶</a></h3>
<p>In contrast to the <a class="reference internal" href="#aggregation-count-star"><span class="std std-ref">count(*)</span></a> function the <code class="docutils literal"><span class="pre">count</span></code>
function used with a column name as parameter will return the number of rows
with a non-<code class="docutils literal"><span class="pre">NULL</span></code> value in that column.</p>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">count</span><span class="p">(</span><span class="k">name</span><span class="p">),</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="nb">date</span> <span class="k">from</span> <span class="n">locations</span> <span class="k">group</span> <span class="k">by</span> <span class="nb">date</span>
<span class="mf">...</span> <span class="k">order</span> <span class="k">by</span> <span class="n">count</span><span class="p">(</span><span class="k">name</span><span class="p">)</span> <span class="k">desc</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+-------------+----------+---------------+</span>
<span class="go">| count(name) | count(*) | date          |</span>
<span class="go">+-------------+----------+---------------+</span>
<span class="go">| 7           | 8        | 1373932800000 |</span>
<span class="go">| 4           | 4        | 308534400000  |</span>
<span class="go">| 1           | 1        | 1367366400000 |</span>
<span class="go">+-------------+----------+---------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
</div>
<div class="section" id="count-distinct-columnname">
<h3><a class="toc-backref" href="#id10"><code class="docutils literal"><span class="pre">count(distinct</span> <span class="pre">columnName)</span></code></a><a class="headerlink" href="#count-distinct-columnname" title="Permalink to this headline">¶</a></h3>
<p>The <cite>count</cite> aggregation function also supports the <cite>distinct</cite> keyword. This
keyword changes the behaviour of the function so that it will only count the
number of distinct values in this column that are not <code class="docutils literal"><span class="pre">NULL</span></code>:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">kind</span><span class="p">),</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="nb">date</span>
<span class="mf">...</span> <span class="k">from</span> <span class="n">locations</span> <span class="k">group</span> <span class="k">by</span> <span class="nb">date</span>
<span class="mf">...</span> <span class="k">order</span> <span class="k">by</span> <span class="n">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">kind</span><span class="p">)</span> <span class="k">desc</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+----------------------+----------+---------------+</span>
<span class="go">| count(DISTINCT kind) | count(*) | date          |</span>
<span class="go">+----------------------+----------+---------------+</span>
<span class="go">| 3                    | 8        | 1373932800000 |</span>
<span class="go">| 3                    | 4        | 308534400000  |</span>
<span class="go">| 1                    | 1        | 1367366400000 |</span>
<span class="go">+----------------------+----------+---------------+</span>
<span class="go"> SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">kind</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+----------------------+</span>
<span class="go">| count(DISTINCT kind) |</span>
<span class="go">+----------------------+</span>
<span class="go">| 3                    |</span>
<span class="go">+----------------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="min">
<h2><a class="toc-backref" href="#id11"><code class="docutils literal"><span class="pre">min</span></code></a><a class="headerlink" href="#min" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">min</span></code> aggregation function returns the smallest value in a column that is
not <code class="docutils literal"><span class="pre">NULL</span></code>. Its single argument is a column name and its return value is
always of the type of that column.</p>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">min</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span>
<span class="mf">...</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">where</span> <span class="k">name</span> <span class="k">not</span> <span class="k">like</span> <span class="s1">&#39;North %&#39;</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">min</span><span class="p">(</span><span class="k">position</span><span class="p">)</span> <span class="k">asc</span><span class="p">,</span> <span class="n">kind</span> <span class="k">asc</span><span class="p">;</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| min(position) | kind        |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| 1             | Planet      |</span>
<span class="go">| 1             | Star System |</span>
<span class="go">| 2             | Galaxy      |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">min</span><span class="p">(</span><span class="nb">date</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+--------------+</span>
<span class="go">| min(date)    |</span>
<span class="go">+--------------+</span>
<span class="go">| 308534400000 |</span>
<span class="go">+--------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">min</span></code> returns <code class="docutils literal"><span class="pre">NULL</span></code> if the column does not contain any value but <code class="docutils literal"><span class="pre">NULL</span></code>.
It is allowed on columns with primitive data types. On <code class="docutils literal"><span class="pre">string</span></code> columns it
will return the lexicographically smallest.</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">min</span><span class="p">(</span><span class="k">name</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">asc</span><span class="p">;</span>
<span class="go">+------------------------------------+-------------+</span>
<span class="go">| min(name)                          | kind        |</span>
<span class="go">+------------------------------------+-------------+</span>
<span class="go">| Galactic Sector QQ7 Active J Gamma | Galaxy      |</span>
<span class="go">|                                    | Planet      |</span>
<span class="go">| Aldebaran                          | Star System |</span>
<span class="go">+------------------------------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
</div>
<div class="section" id="max">
<h2><a class="toc-backref" href="#id12"><code class="docutils literal"><span class="pre">max</span></code></a><a class="headerlink" href="#max" title="Permalink to this headline">¶</a></h2>
<p>It behaves exactly like <code class="docutils literal"><span class="pre">min</span></code> but returns the biggest value in a column that
is not <code class="docutils literal"><span class="pre">NULL</span></code>.</p>
<p>Some Examples:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">max</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| max(position) | kind        |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| 4             | Star System |</span>
<span class="go">| 5             | Planet      |</span>
<span class="go">| 6             | Galaxy      |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">max</span><span class="p">(</span><span class="k">position</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+---------------+</span>
<span class="go">| max(position) |</span>
<span class="go">+---------------+</span>
<span class="go">| 6             |</span>
<span class="go">+---------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">max</span><span class="p">(</span><span class="k">name</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">max</span><span class="p">(</span><span class="k">name</span><span class="p">)</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+-------------------+-------------+</span>
<span class="go">| max(name)         | kind        |</span>
<span class="go">+-------------------+-------------+</span>
<span class="go">| Outer Eastern Rim | Galaxy      |</span>
<span class="go">| Bartledan         | Planet      |</span>
<span class="go">| Altair            | Star System |</span>
<span class="go">+-------------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
</div>
<div class="section" id="sum">
<h2><a class="toc-backref" href="#id13"><code class="docutils literal"><span class="pre">sum</span></code></a><a class="headerlink" href="#sum" title="Permalink to this headline">¶</a></h2>
<p>returns the sum of a set of numeric input values that are not <code class="docutils literal"><span class="pre">NULL</span></code>.
Depending on the argument type a suitable return type is chosen. For float and
double argument types the return type is equal to the argument type. For byte,
short, integer and long the return type changes to long. If the range of long
values (-2^64 to 2^64-1) gets exceeded an ArithmeticException will be raised.</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">sum</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">sum</span><span class="p">(</span><span class="k">position</span><span class="p">)</span> <span class="k">asc</span><span class="p">;</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| sum(position) | kind        |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| 10            | Star System |</span>
<span class="go">| 13            | Galaxy      |</span>
<span class="go">| 15            | Planet      |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">sum</span><span class="p">(</span><span class="k">position</span><span class="p">)</span> <span class="k">as</span> <span class="n">position_sum</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+--------------+</span>
<span class="go">| position_sum |</span>
<span class="go">+--------------+</span>
<span class="go">| 38           |</span>
<span class="go">+--------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">sum</span><span class="p">(</span><span class="k">name</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">sum</span><span class="p">(</span><span class="k">name</span><span class="p">)</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">SQLActionException[SQLParseException: Cannot cast name to type [double, float, long, integer, short, byte]]</span>
</pre></div>
</div>
</div>
<div class="section" id="avg-and-mean">
<h2><a class="toc-backref" href="#id14"><code class="docutils literal"><span class="pre">avg</span></code> and <code class="docutils literal"><span class="pre">mean</span></code></a><a class="headerlink" href="#avg-and-mean" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">avg</span></code> and <code class="docutils literal"><span class="pre">mean</span></code> aggregation function returns the arithmetic mean, the
<em>average</em>, of all values in a column that are not <code class="docutils literal"><span class="pre">NULL</span></code> as a double value.
It accepts all numeric columns and timestamp columns as single argument. Using
<code class="docutils literal"><span class="pre">avg</span></code> on other column types is not allowed.</p>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">avg</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span><span class="p">;</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| avg(position) | kind        |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">| 3.25          | Galaxy      |</span>
<span class="go">| 3.0           | Planet      |</span>
<span class="go">| 2.5           | Star System |</span>
<span class="go">+---------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="section" id="avg-distinct-columnname">
<h3><a class="toc-backref" href="#id15"><code class="docutils literal"><span class="pre">avg(distinct</span> <span class="pre">columnName)</span></code></a><a class="headerlink" href="#avg-distinct-columnname" title="Permalink to this headline">¶</a></h3>
<p>The <cite>avg</cite> aggregation function also supports the <cite>distinct</cite> keyword. This
keyword changes the behaviour of the function so that it will only average the
number of distinct values in this column that are not <code class="docutils literal"><span class="pre">NULL</span></code>:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">avg</span><span class="p">(</span><span class="k">distinct</span> <span class="k">position</span><span class="p">),</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="nb">date</span>
<span class="mf">...</span> <span class="k">from</span> <span class="n">locations</span> <span class="k">group</span> <span class="k">by</span> <span class="nb">date</span>
<span class="mf">...</span> <span class="k">order</span> <span class="k">by</span> <span class="n">avg</span><span class="p">(</span><span class="k">distinct</span> <span class="k">position</span><span class="p">)</span> <span class="k">desc</span><span class="p">,</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+------------------------+----------+---------------+</span>
<span class="go">| avg(DISTINCT position) | count(*) |          date |</span>
<span class="go">+------------------------+----------+---------------+</span>
<span class="go">|                    4.0 |        1 | 1367366400000 |</span>
<span class="go">|                    3.6 |        8 | 1373932800000 |</span>
<span class="go">|                    2.0 |        4 |  308534400000 |</span>
<span class="go">+------------------------+----------+---------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">avg</span><span class="p">(</span><span class="k">distinct</span> <span class="k">position</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+------------------------+</span>
<span class="go">| avg(DISTINCT position) |</span>
<span class="go">+------------------------+</span>
<span class="go">|                    3.5 |</span>
<span class="go">+------------------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="geometric-mean">
<h2><a class="toc-backref" href="#id16"><code class="docutils literal"><span class="pre">geometric_mean</span></code></a><a class="headerlink" href="#geometric-mean" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">geometric_mean</span></code> aggregation function computes the geometric mean, a mean
for positive numbers. For details see: <a class="reference external" href="https://en.wikipedia.org/wiki/Mean#Geometric_mean_.28GM.29">Geometric Mean</a>.</p>
<p><code class="docutils literal"><span class="pre">geometric</span> <span class="pre">mean</span></code> is defined on all numeric types and on timestamp. It always
returns double values. If a value is negative, all values were null or we got
no value at all <code class="docutils literal"><span class="pre">NULL</span></code> is returned. If any of the aggregated values is <code class="docutils literal"><span class="pre">0</span></code>
the result will be <code class="docutils literal"><span class="pre">0.0</span></code> as well.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to java double precision arithmetic it is possible that any two
executions of the aggregation function on the same data produce slightly
differing results.</p>
</div>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">geometric_mean</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span><span class="p">;</span>
<span class="go">+--------------------------+-------------+</span>
<span class="go">| geometric_mean(position) | kind        |</span>
<span class="go">+--------------------------+-------------+</span>
<span class="go">|       2.6321480259049848 | Galaxy      |</span>
<span class="go">|       2.6051710846973517 | Planet      |</span>
<span class="go">|       2.213363839400643  | Star System |</span>
<span class="go">+--------------------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
</div>
<div class="section" id="variance">
<h2><a class="toc-backref" href="#id17"><code class="docutils literal"><span class="pre">variance</span></code></a><a class="headerlink" href="#variance" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">variance</span></code> aggregation function computes the <a class="reference external" href="https://en.wikipedia.org/wiki/Variance">Variance</a> of the set of
non-null values in a column. It is a measure about how far a set of numbers is
spread. A variance of <code class="docutils literal"><span class="pre">0.0</span></code> indicates that all values are the same.</p>
<p><code class="docutils literal"><span class="pre">variance</span></code> is defined on all numeric types and on timestamp. It returns a
double value. If all values were null or we got no value at all <code class="docutils literal"><span class="pre">NULL</span></code> is
returned.</p>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">variance</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+--------------------+-------------+</span>
<span class="go">| variance(position) | kind        |</span>
<span class="go">+--------------------+-------------+</span>
<span class="go">|             1.25   | Star System |</span>
<span class="go">|             2.0    | Planet      |</span>
<span class="go">|             3.6875 | Galaxy      |</span>
<span class="go">+--------------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to java double precision arithmetic it is possible that any two
executions of the aggregation function on the same data produce slightly
differing results.</p>
</div>
</div>
<div class="section" id="stddev">
<h2><a class="toc-backref" href="#id18"><code class="docutils literal"><span class="pre">stddev</span></code></a><a class="headerlink" href="#stddev" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">stddev</span></code> aggregation function computes the <a class="reference external" href="https://en.wikipedia.org/wiki/Standard_deviation">Standard Deviation</a> of the
set of non-null values in a column. It is a measure of the variation of data
values. A low standard deviation indicates that the values tend to be near the
mean.</p>
<p><code class="docutils literal"><span class="pre">stddev</span></code> is defined on all numeric types and on timestamp. It always returns
double values. If all values were null or we got no value at all <code class="docutils literal"><span class="pre">NULL</span></code> is
returned.</p>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">stddev</span><span class="p">(</span><span class="k">position</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span><span class="p">;</span>
<span class="go">+--------------------+-------------+</span>
<span class="go">|   stddev(position) | kind        |</span>
<span class="go">+--------------------+-------------+</span>
<span class="go">| 1.920286436967152  | Galaxy      |</span>
<span class="go">| 1.4142135623730951 | Planet      |</span>
<span class="go">| 1.118033988749895  | Star System |</span>
<span class="go">+--------------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to java double precision arithmetic it is possible that any two
executions of the aggregation function on the same data produce slightly
differing results.</p>
</div>
</div>
<div class="section" id="percentile">
<h2><a class="toc-backref" href="#id19"><code class="docutils literal"><span class="pre">percentile</span></code></a><a class="headerlink" href="#percentile" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">percentile</span></code> aggregation function computes a <a class="reference external" href="https://en.wikipedia.org/wiki/Percentile">Percentile</a> over numeric
non-null values in a column.</p>
<p>Percentiles show the point at which a certain percentage of observed values
occur. For example, the 98th percentile is the value which is greater than 98%
of the observed values. The result is defined and computed as an interpolated
weighted average. According to that it allows the median of the input data to
be defined conveniently as the 50th percentile.</p>
<p>The function expects a single fraction or an array of fractions and a column
name. Independent of the input column data type the result of <code class="docutils literal"><span class="pre">percentile</span></code>
always returns a double. If the value at the specified column is <code class="docutils literal"><span class="pre">null</span></code> the
row is ignored. Fractions must be double precision values between 0 and 1. When
supplied a single fraction, the function will return a single value
corresponding to the percentile of the specified fraction:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">percentile</span><span class="p">(</span><span class="k">position</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span><span class="p">;</span>
<span class="go">+----------------------------+-------------+</span>
<span class="go">| percentile(position, 0.95) | kind        |</span>
<span class="go">+----------------------------+-------------+</span>
<span class="go">|         5.699999999999999  | Galaxy      |</span>
<span class="go">|         4.8                | Planet      |</span>
<span class="go">|         3.8499999999999996 | Star System |</span>
<span class="go">+----------------------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<p>When supplied an array of fractions, the function will return an array of
values corresponding to the percentile of each fraction specified:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">percentile</span><span class="p">(</span><span class="k">position</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.0013</span><span class="p">,</span> <span class="mf">0.9987</span><span class="p">])</span> <span class="k">as</span> <span class="n">perc</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+--------------------------+</span>
<span class="go">| perc                     |</span>
<span class="go">+--------------------------+</span>
<span class="go">| [1.0, 5.984400000000001] |</span>
<span class="go">+--------------------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<p>When a query with <code class="docutils literal"><span class="pre">percentile</span></code> function won&#8217;t match any rows then a null
result is returned.</p>
<p>To be able to calculate percentiles over a huge amount of data and to scale out
CrateDB calculates approximate instead of accurate percentiles. The algorithm
used by the percentile metric is called <a class="reference external" href="https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf">TDigest</a>. The accuracy/size trade-off
of the algorithm is defined by a single compression parameter which has a
constant value of <code class="docutils literal"><span class="pre">100</span></code>. However, there are a few guidelines to keep in mind
in this implementation:</p>
<blockquote>
<div><ul class="simple">
<li>Extreme percentiles (e.g. 99%) are more accurate</li>
<li>For small sets percentiles are highly accurate</li>
<li>It&#8217;s difficult to generalize the exact level of accuracy, as it depends
on your data distribution and volume of data being aggregated</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="arbitrary">
<h2><a class="toc-backref" href="#id20"><code class="docutils literal"><span class="pre">arbitrary</span></code></a><a class="headerlink" href="#arbitrary" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">arbitrary</span></code> aggregation function returns a single value of a column.
Which value it returns is not defined.</p>
<p>It accepts references to columns of all primitive types.</p>
<p>Using <code class="docutils literal"><span class="pre">arbitrary</span></code> on <code class="docutils literal"><span class="pre">Object</span></code> columns is not supported.</p>
<p>Its return type is the type of its parameter column and can be <code class="docutils literal"><span class="pre">NULL</span></code> if the
column contains <code class="docutils literal"><span class="pre">NULL</span></code> values.</p>
<p>Example:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">arbitrary</span><span class="p">(</span><span class="k">position</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+---------------------+</span>
<span class="go">| arbitrary(position) |</span>
<span class="go">+---------------------+</span>
<span class="go">| ...                 |</span>
<span class="go">+---------------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">arbitrary</span><span class="p">(</span><span class="k">name</span><span class="p">),</span> <span class="n">kind</span> <span class="k">from</span> <span class="n">locations</span>
<span class="mf">...</span> <span class="k">where</span> <span class="k">name</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span>
<span class="mf">...</span> <span class="k">group</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">order</span> <span class="k">by</span> <span class="n">kind</span> <span class="k">desc</span><span class="p">;</span>
<span class="go">+-...-------------+-------------+</span>
<span class="go">| arbitrary(name) | kind        |</span>
<span class="go">+-...-------------+-------------+</span>
<span class="go">| ...             | Star System |</span>
<span class="go">| ...             | Planet      |</span>
<span class="go">| ...             | Galaxy      |</span>
<span class="go">+-...-------------+-------------+</span>
<span class="go">SELECT 3 rows in set (... sec)</span>
</pre></div>
</div>
<p>An example use case is to group a table with many rows per user by <code class="docutils literal"><span class="pre">user_id</span></code>
and get the <code class="docutils literal"><span class="pre">username</span></code> for every group, that means every user. This works as
rows with same <code class="docutils literal"><span class="pre">user_id</span></code> have the same <code class="docutils literal"><span class="pre">username</span></code>.  This method performs
better than grouping on <code class="docutils literal"><span class="pre">username</span></code> as grouping on number types is generally
faster than on strings.  The advantage is that the <code class="docutils literal"><span class="pre">arbitrary</span></code> function does
very little to no computation as for example <code class="docutils literal"><span class="pre">max</span></code> aggregation function would
do.</p>
</div>
<div class="section" id="hyperloglog-distinct">
<span id="aggregation-hll-distinct"></span><h2><a class="toc-backref" href="#id21"><code class="docutils literal"><span class="pre">hyperloglog_distinct</span></code></a><a class="headerlink" href="#hyperloglog-distinct" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">hyperloglog_distinct</span></code> aggregate function is an <a class="reference internal" href="../../enterprise/index.html#enterprise-features"><span class="std std-ref">enterprise
feature</span></a>.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">hyperloglog_distinct</span></code> aggregate function calculates an approximate count
of distinct non-null values using the <a class="reference external" href="https://research.google.com/pubs/pub40671.html">HyperLogLog++</a> algorithm.</p>
<p>The return value data type is always a long.</p>
<p>The first argument can be a reference to a column of all
<a class="reference internal" href="../ddl/data-types.html#sql-ddl-datatypes-primitives"><span class="std std-ref">Primitive Types</span></a>. <a class="reference internal" href="../ddl/data-types.html#sql-ddl-datatypes-compound"><span class="std std-ref">Compound Types</span></a> and
<a class="reference internal" href="../ddl/data-types.html#sql-ddl-datatypes-geographic"><span class="std std-ref">Geographic Types</span></a> are not supported.</p>
<p>The optional second argument defines the used <code class="docutils literal"><span class="pre">precision</span></code> for the
<a class="reference external" href="https://research.google.com/pubs/pub40671.html">HyperLogLog++</a> algorithm. This allows to trade memory for accuracy, valid
values are <code class="docutils literal"><span class="pre">4</span></code> to <code class="docutils literal"><span class="pre">18</span></code>.
The default value for the <code class="docutils literal"><span class="pre">precision</span></code> which is used if the second argument is
left out is <code class="docutils literal"><span class="pre">14</span></code>.</p>
<p>Examples:</p>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">hyperloglog_distinct</span><span class="p">(</span><span class="k">position</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+--------------------------------+</span>
<span class="go">| hyperloglog_distinct(position) |</span>
<span class="go">+--------------------------------+</span>
<span class="go">| 6                              |</span>
<span class="go">+--------------------------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
<div class="highlight-psql"><div class="highlight"><pre><span></span><span class="n">cr</span><span class="o">&gt;</span> <span class="k">select</span> <span class="n">hyperloglog_distinct</span><span class="p">(</span><span class="k">position</span><span class="p">,</span> <span class="mf">4</span><span class="p">)</span> <span class="k">from</span> <span class="n">locations</span><span class="p">;</span>
<span class="go">+-----------------------------------+</span>
<span class="go">| hyperloglog_distinct(position, 4) |</span>
<span class="go">+-----------------------------------+</span>
<span class="go">| 6                                 |</span>
<span class="go">+-----------------------------------+</span>
<span class="go">SELECT 1 row in set (... sec)</span>
</pre></div>
</div>
</div>
<div class="section" id="limitations">
<h2><a class="toc-backref" href="#id22">Limitations</a><a class="headerlink" href="#limitations" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">DISTINCT</span></code> is not supported with aggregations on <a class="reference internal" href="../dql/joins.html#sql-joins"><span class="std std-ref">Joins</span></a>.</li>
<li>Prior to 2.0.0, unless documented, global aggregation functions are
unsupported in combination with <code class="docutils literal"><span class="pre">DISTINCT</span></code>.</li>
<li>Aggregation functions can only be applied to columns with a plain index,
which is the default for all <a class="reference internal" href="../ddl/data-types.html#sql-ddl-datatypes-primitives"><span class="std std-ref">primitive type</span></a> columns. For more information, please refer
to <a class="reference internal" href="../ddl/fulltext-indices.html#sql-ddl-index-plain"><span class="std std-ref">Plain index (Default)</span></a>.</li>
</ul>
</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
  </div><footer class="footer">
  <div class="w-container">
    <div class="w-clearfix">
      <div class="w-row mobileAlign">
        <div class="w-col w-col-3 footer-menu">
          <p class="menu-Label">Product</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new"><a href="https://crate.io/overview/">Overview</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/download/">Download</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/use-cases/">Use Cases</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/customers/">Customers</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/pricing/">Pricing</a></li>
          </ul>
        </div>
        <div class="w-col w-col-3 footer-menu">
          <p class="menu-Label">Resources</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new"><a href="https://crate.io/resources/">Resource Library</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/docs/">Documentation</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/docs/support/">Support</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/events/">Events</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/blog/">Blog</a></li>
          </ul>
        </div>
        <div class="w-col w-col-3 footer-menu">
          <p class="menu-Label">Company</p>
          <ul class="vertical-menu">
            <li class="footer-listitem-new "><a href="https://crate.io/about/">About</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/jobs/">Jobs</a></li>
            <li class="footer-listitem-new "><a href="https://crate.io/partners/">Partners</a></li>
            <li class="footer-listitem-new"><a href="https://crate.io/in-the-news/">In the News</a></li>
          </ul>
        </div>
        <div class="w-col w-col-3">
          <ul class="footer-list w-list-unstyled" style="margin-top: 0; padding-left: 0;">
            <li class="footer-listitem">
              <a class="footer-link-connect w-inline-block" href="https://www.facebook.com/crate.io" target="_blank" style="padding-left: 0;">
                <img src="../../_static/images/f-logo-facebook.png" width="12">
              </a>
            </li>
            <li class="footer-listitem">
              <a class="footer-link-connect w-inline-block" href="https://twitter.com/Crateio" target="_blank">
                <img src="../../_static/images/f-logo-twitter.png" width="23">
              </a>
            </li>
            <li class="footer-listitem">
              <a class="footer-link-connect w-inline-block" href="https://plus.google.com/105753392254543335997" target="_blank">
                <img src="../../_static/images/f-logo-google.png" width="23">
              </a>
            </li>
            <li class="footer-listitem">
              <a class="footer-link-connect w-inline-block" href="https://www.linkedin.com/company/crateio" target="_blank">
                <img src="../../_static/images/f-logo-linkedin.png" width="22">
              </a>
            </li>
            <li class="footer-listitem">
              <a class="footer-link-connect w-inline-block" href="https://www.youtube.com/channel/UCcp_IqjXaejmwBcwg51n1AA" target="_blank">
                <img src="../../_static/images/f-logo-youtube.png" width="24">
              </a>
            </li>
            <li class="footer-listitem">
              <a class="footer-link-connect w-inline-block" href="https://github.com/crate">
                <img src="../../_static/images/f-logo-github.png" width="22">
              </a>
            </li>
            <div class="mobileHoriztonalMenu">
              <li class="footer-listitem-new"><a href="https://crate.io/contact/">Contact</a></li>
              <li class="footer-listitem-new"><a href="https://crate.io/legal/">Legal</a></li>
              <li class="footer-listitem-new"><a href="https://crate.io/legal/imprint/">Imprint</a></li>
            </div>
            <li class="footer-listitem link-list">
              <a class="footer-link-eu w-inline-block" href="/erdf/">
                <img class="logo-eu" sizes="100px" src="../../_static/images/logo-eu-optimized-1.jpg" width="101">
              </a>
            </li>
          </ul>
        </div>
      </div>
      <div class="w-row">
        <a class="brand footer-brand w-inline-block" href="/">
          <img src="../../_static/images/logo-crate.png" width="217">
        </a>
      </div>
    </div>
  </div>
</footer>

  <script>
  var $navAffix = $('#nav-affix');
  var $contentEl = $('.wrapper-content-right');
  // Desktop only
  if( !$('#mobile-menu-toggler').is(':visible') ) {

    // Only if the content is taller than the sidebar,
    // to avoid scroll jerk
    if ( $contentEl.height() > $navAffix.height() ) {
      // Init
      $navAffix.affix({
        offset: {
          top: 100,
          bottom: function () {
            return (this.bottom = $('footer').outerHeight(true) + 200)
          }
        }
      });
      // Recalculate the sidebar
      $(window).resize(function() {
        $navAffix.affix('checkPosition');
      });
    }

    $('body').scrollspy();

  } else {

    $('.wrapper-navleft').hide();
    $('#mobile-menu-toggler').click(function() {
      $('.wrapper-navleft').toggle();
    });

  }

  $(document).ready(function() {
    window.setTimeout(function() {$('body').append('<a href="https://crate.io/docs/support/slackin/" style="z-index: 10; position: fixed; bottom: 20px; right: ' + ($('#intercom-launcher').is(':visible') ? '90' : '20') + 'px; box-shadow: 0 6px 13px 0 rgba(0, 0, 0, .23)"><img src="../../_static/images/slack.png" id="slack-container" /></a>'); }, 2000);
  });
  </script>

  <!-- Segment -->
  <script>
    !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on","setAnonymousId"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
      analytics.load("FToR4cE5lXyQziQirvt0kSnFQj0rAgu9");
      analytics.setAnonymousId($.cookie('uid'));
      analytics.page();
      analytics.track('visited_section_docs', {
        project: 'crate',
        version: ''
      });
    }}();
  </script>
  </body>
</html>